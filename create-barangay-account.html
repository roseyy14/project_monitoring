<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create Barangay Account</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      max-width: 500px;
      width: 100%;
    }
    h1 {
      color: #1f2937;
      margin-bottom: 8px;
      font-size: 24px;
    }
    .subtitle {
      color: #6b7280;
      margin-bottom: 32px;
      font-size: 14px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      color: #374151;
      font-weight: 500;
      font-size: 14px;
    }
    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }
    button {
      width: 100%;
      padding: 14px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #5568d3;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .message {
      margin-top: 16px;
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
      display: none;
    }
    .message.error {
      background: #fee2e2;
      color: #991b1b;
      display: block;
    }
    .message.success {
      background: #d1fae5;
      color: #065f46;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Create Barangay Account</h1>
    <p class="subtitle">Temporary tool to register barangay officials</p>
    
    <form id="createAccountForm">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" required placeholder="barangay1@gmail.com" />
      </div>
      
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" required placeholder="Minimum 6 characters" />
      </div>
      
      <div class="form-group">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" required placeholder="Juan Dela Cruz" />
      </div>
      
      <div class="form-group">
        <label for="barangay">Barangay/Location</label>
        <select id="barangay" required>
          <option value="" selected disabled>Select barangay</option>
          <option value="OYANDIC">OYANDIC</option>
          <option value="POBLACION 1">POBLACION 1</option>
          <option value="POBLACION 1-A">POBLACION 1-A</option>
          <option value="CALAPI">CALAPI</option>
          <option value="BONGA">BONGA</option>
          <option value="NEW MINAROG">NEW MINAROG</option>
          <option value="ANGYAP">ANGYAP</option>
          <option value="MAYPANGE">MAYPANGE</option>
          <option value="CANDUMACOL">CANDUMACOL</option>
          <option value="CANATUAN">CANATUAN</option>
          <option value="MALOBAGO">MALOBAGO</option>
          <option value="INALAD">INALAD</option>
          <option value="CALUYAHAN">CALUYAHAN</option>
          <option value="PAMAMAS-AN">PAMAMAS-AN</option>
          <option value="PUSONGAN">PUSONGAN</option>
        </select>
      </div>
      
      <button type="submit" id="submitBtn">Create Account</button>
      
      <div id="message" class="message"></div>
    </form>
  </div>

  <script type="module">
    import { auth, db } from './scripts/core/firebase.js';
    import { createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';
    import { doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';

    const form = document.getElementById('createAccountForm');
    const submitBtn = document.getElementById('submitBtn');
    const message = document.getElementById('message');
    const barangaySelect = document.getElementById('barangay');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const fullNameInput = document.getElementById('fullName');

    // Random Filipino names
    const randomNames = [
      'Juan Dela Cruz',
      'Maria Santos',
      'Jose Reyes',
      'Ana Garcia',
      'Pedro Ramos',
      'Rosa Martinez',
      'Carlos Mendoza',
      'Elena Fernandez',
      'Miguel Torres',
      'Sofia Gonzales',
      'Ramon Villanueva',
      'Carmen Lopez',
      'Antonio Cruz',
      'Luz Rivera',
      'Francisco Bautista',
      'Gloria Aquino',
      'Manuel Castillo',
      'Josefa Domingo',
      'Ricardo Flores',
      'Teresa Morales',
      'Ernesto Dela Cruz',
      'Leonor Santiago',
      'Roberto Romero',
      'Violeta Navarro',
      'Eduardo Pascual'
    ];

    // Auto-fill form when barangay is selected
    barangaySelect.addEventListener('change', function() {
      const selectedBarangay = this.value;
      if (selectedBarangay) {
        // Generate email: barangay name (lowercase, no spaces) + @gmail.com
        const emailPrefix = selectedBarangay.toLowerCase().replace(/\s+/g, '').replace(/-/g, '');
        emailInput.value = `${emailPrefix}@gmail.com`;
        
        // Generate password: barangay name (lowercase, no spaces) + 123
        passwordInput.value = `${emailPrefix}123`;
        
        // Random name
        const randomName = randomNames[Math.floor(Math.random() * randomNames.length)];
        fullNameInput.value = randomName;
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const fullName = document.getElementById('fullName').value.trim();
      const barangay = document.getElementById('barangay').value;
      
      // Validation
      if (password.length < 6) {
        showMessage('Password must be at least 6 characters', 'error');
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating account...';
      
      try {
        // Create auth account
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Save to Firestore
        await setDoc(doc(db, 'users', user.uid), {
          uid: user.uid,
          email: email,
          fullName: fullName,
          role: 'baranggay_official',
          barangay: barangay,
          createdAt: serverTimestamp()
        });
        
        showMessage(`Account created successfully! UID: ${user.uid}`, 'success');
        
        // Reset form after 2 seconds
        setTimeout(() => {
          form.reset();
          message.style.display = 'none';
        }, 3000);
        
      } catch (error) {
        console.error('Error creating account:', error);
        
        let errorMessage = 'Failed to create account. ';
        if (error.code === 'auth/email-already-in-use') {
          errorMessage += 'Email already exists.';
        } else if (error.code === 'auth/invalid-email') {
          errorMessage += 'Invalid email format.';
        } else if (error.code === 'auth/weak-password') {
          errorMessage += 'Password is too weak.';
        } else {
          errorMessage += error.message;
        }
        
        showMessage(errorMessage, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create Account';
      }
    });
    
    function showMessage(text, type) {
      message.textContent = text;
      message.className = `message ${type}`;
      message.style.display = 'block';
    }
  </script>
</body>
</html>
